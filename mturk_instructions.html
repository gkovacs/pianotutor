<script>
// Generated by CoffeeScript 1.6.3
(function() {
  var acceptHIT, checkCode, codeKeypress, documentReady, getUrlParameters, getWorkerId, insertScript, isChrome, isComboBoxZero, isRadioEmpty, isTextEmpty, pleaseAnswer, root, taskAcceptedByWorker, testPlayNote, toHitCode, validateForm;

  root = typeof exports !== "undefined" && exports !== null ? exports : this;

  root.taskname = '${taskname}';

  if (root.taskname.indexOf('taskname') !== -1) {
    root.taskname = 'foobarrr';
  }

  getUrlParameters = root.getUrlParameters = function() {
    var map, parts;
    map = {};
    parts = window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, function(m, key, value) {
      return map[key] = decodeURI(value);
    });
    return map;
  };

  getWorkerId = root.getWorkerId = function() {
    var params;
    params = getUrlParameters();
    if (params.workerId != null) {
      return params.workerId;
    }
    return '';
  };

  insertScript = root.insertScript = function(url) {
    var scriptTag;
    scriptTag = document.createElement('script');
    scriptTag.type = 'text/javascript';
    scriptTag.src = url;
    return document.documentElement.appendChild(scriptTag);
  };

  taskAcceptedByWorker = root.taskAcceptedByWorker = function(accepted_taskname) {
    if (accepted_taskname === '' || accepted_taskname === root.taskname) {
      return console.log('taskname matches: ' + accepted_taskname);
    } else {
      console.log('taskname mismatch: ' + accepted_taskname + ' vs ' + root.taskname);
      return document.getElementById('dupwarning').style.display = '';
    }
  };

  acceptHIT = root.acceptHIT = function() {
    console.log('hit accepted');
    return insertScript('//pianotutor.herokuapp.com/taskAcceptedByWorker.js?callback=taskAcceptedByWorker&workerid=' + encodeURI(getWorkerId()) + '&taskname=' + encodeURI(root.taskname));
  };

  toHitCode = root.toHitCode = function(taskname) {
    var char, hash, i, _i, _ref;
    hash = 0;
    if (taskname.length === 0) {
      return hash;
    }
    for (i = _i = 0, _ref = taskname.length; 0 <= _ref ? _i < _ref : _i > _ref; i = 0 <= _ref ? ++_i : --_i) {
      char = taskname.charCodeAt(i);
      hash = ((hash << 5) - hash) + char;
      hash |= 0;
    }
    if (hash < 0) {
      return Math.floor(-hash / 4096);
    }
    return Math.floor(hash / 4096);
  };

  root.testPlayNote = testPlayNote = function() {
    var audioTag;
    console.log('note played!');
    audioTag = document.getElementById('testNote');
    audioTag.pause();
    audioTag.currentTime = 0.0;
    return audioTag.play();
  };

  root.codeKeypress = codeKeypress = function(event) {
    if (event.keyCode === 13) {
      checkCode();
      event.preventDefault();
      return false;
    } else {
      document.getElementById('codeCorrect').style.display = 'none';
      document.getElementById('codeIncorrect').style.display = 'none';
      return true;
    }
  };

  root.checkCode = checkCode = function() {
    var expected_hitcode, hitcode, submitButton;
    expected_hitcode = toHitCode(root.taskname).toString();
    hitcode = document.getElementById('hitcode').value.trim();
    if (hitcode !== expected_hitcode) {
      document.getElementById('codeCorrect').style.display = 'none';
      return document.getElementById('codeIncorrect').style.display = '';
    } else {
      document.getElementById('codeCorrect').style.display = '';
      document.getElementById('codeIncorrect').style.display = 'none';
      document.getElementById('checkCodeButton').disabled = true;
      document.getElementById('hitcode').disabled = true;
      document.getElementById('survey').style.display = '';
      submitButton = document.getElementById('submitButton');
      if (submitButton != null) {
        return submitButton.style.display = '';
      }
    }
  };

  isComboBoxZero = root.isComboBoxZero = function(name) {
    return document.getElementsByName(name)[0].value === '0';
  };

  isTextEmpty = root.isTextEmpty = function(name) {
    return document.getElementsByName(name)[0].value === '';
  };

  isRadioEmpty = root.isRadioEmpty = function(name) {
    var checked, x, _i, _len, _ref;
    checked = false;
    _ref = document.getElementsByName(name);
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      x = _ref[_i];
      if (x.checked) {
        checked = true;
      }
    }
    return !checked;
  };

  pleaseAnswer = function(name) {
    return alert('please answer survey question ' + name);
  };

  root.validateForm = validateForm = function() {
    var expected_hitcode, hitcode;
    expected_hitcode = toHitCode(root.taskname).toString();
    hitcode = document.getElementById('hitcode').value.trim();
    if (hitcode !== expected_hitcode) {
      alert('the code you input: "' + hitcode + '" is not correct');
      return false;
    }
    if (!isChrome()) {
      alert('You must use Google Chrome to do this task');
      return false;
    }
    if (isComboBoxZero('musicexperience')) {
      pleaseAnswer(3);
      return false;
    }
    if (isComboBoxZero('musicrecency')) {
      pleaseAnswer(4);
      return false;
    }
    if (isComboBoxZero('pianoexperience')) {
      pleaseAnswer(5);
      return false;
    }
    if (isComboBoxZero('pianorecency')) {
      pleaseAnswer(6);
      return false;
    }
    if (isRadioEmpty('piece1heard')) {
      pleaseAnswer(7);
      return false;
    }
    if (isRadioEmpty('piece1played')) {
      pleaseAnswer(7);
      return false;
    }
    if (isRadioEmpty('piece2heard')) {
      pleaseAnswer(7);
      return false;
    }
    if (isRadioEmpty('piece2played')) {
      pleaseAnswer(7);
      return false;
    }
    return true;
  };

  isChrome = function() {
    return /Chrome/.test(navigator.userAgent) && /Google Inc/.test(navigator.vendor);
  };

  documentReady = function() {
    var startTask, submitButton, workerid;
    submitButton = document.getElementById('submitButton');
    if (submitButton != null) {
      submitButton.onclick = 'return validateForm()';
    }
    if (!isChrome()) {
      document.getElementById('chromewarning').style.display = '';
      if (submitButton != null) {
        submitButton.disabled = true;
      }
      startTask = document.getElementById('startTask');
      if (startTask.text != null) {
        startTask.text = 'You must use Google Chrome to do this task. Open this HIT in Google Chrome to do the task.';
      }
      if (startTask.textContent != null) {
        startTask.textContent = 'You must use Google Chrome to do this task. Open this HIT in Google Chrome to do the task.';
      }
      startTask.href = 'http://www.google.com/chrome';
      document.getElementById('checkCodeButton').disabled = true;
      return document.getElementById('hitcode').disabled = true;
    } else {
      startTask = document.getElementById('startTask');
      startTask.href = '//pianotutor.herokuapp.com/mturk_index_' + root.taskname + '.html';
      workerid = getWorkerId();
      if (workerid !== '') {
        startTask.href = '//pianotutor.herokuapp.com/mturk_index_' + root.taskname + '.html?workerId=' + encodeURI(workerid);
        return acceptHIT();
      }
    }
  };

  document.onreadystatechange = function() {
    if (document.readyState === 'complete') {
      return documentReady();
    }
  };

}).call(this);
</script>
<h1 id="chromewarning" style="display: none; background-color: yellow">You must use the <a href="http://www.google.com/chrome" target="_blank">Google Chrome</a> browser. You will not be able to do this task in other browsers.</h1>
<h1 id="dupwarning" style="display: none; background-color: yellow">You have already accepted another HIT in this group. You may only do one HIT. Please release this HIT.</h1>
<h3>Summary</h3>

<p>In this task, we will have you try out a "virtual piano tutor", which teaches you the basics of playing music using your computer. You do <strong>NOT</strong> need any experience with music to do this task.</p>

<h3>Requirements</h3>

<p>Your computer must be able to <strong>play sound</strong>. <button onclick="testPlayNote(); return false">Click here</button> to test; you should hear a note. <audio id="testNote" src="//pianotutor.herokuapp.com/piano/Piano.ff.C4.m4a" style="display: none"></audio></p>

<h3>Instructions</h3>

<p>In this task, we will turn your keyboard into a musical instrument, by assigning notes to each of the keys.
You will be shown a list of notes to play, and you will play each note by pressing the corresponding key on your keyboard (which will be highlighted). For example, to play the note "e1", you would press the "g" key.
This is what the task looks like:</p>

<p><img src="//pianotutor.herokuapp.com/anim.gif" alt="Virtual Piano Note Sequence Example" title="" /></p>

<p>Your objective will be to <strong>play back notes as fast as you can, without making mistakes</strong>. If you make a mistake, you will need to repeat the line. Once you are able to play the line of notes without any mistakes, it will advance to the next line.</p>

<p>Once you are done playing all the lines of notes we give you, you will be given a code that you can enter below, answer a brief survey, and submit the HIT.</p>
<b><a href="http://google.com/chrome" id="startTask" target="_blank">Start the task to get a code (will open in a new window)</a></b>

<br/><br/>

Code you got from completing the task: <input id="hitcode" name="hitcode" onkeypress="return codeKeypress(event)"></input><button id="checkCodeButton" onclick="checkCode(); return false">Check Code</button><span id="codeCorrect" style="color: green; display: none">Correct! Answer survey below and submit.</span><span id="codeIncorrect" style="color: red; display: none">Incorrect code</span>

<div id="survey" style="display: none">

<h3>Survey</h3>

1) Can you read music? If yes, what is the note shown below?<br/>
Note name (leave blank if you cannot read music): <input id="notename" name="notename"></input><br/>
<img src="//pianotutor.herokuapp.com/samplenote.png"></img>

<br/><br/>

2) List any instruments you can play (list instruments you have the most experience with first):<br/>
Instrument 1: <input id="instrument1" name="instrument1"></input><br/>
Instrument 2: <input id="instrument2" name="instrument2"></input><br/>
Instrument 3: <input id="instrument3" name="instrument3"></input><br/>
Instrument 4: <input id="instrument4" name="instrument4"></input><br/>
Instrument 5: <input id="instrument5" name="instrument5"></input>

<br/><br/>

3) How much <b>experience</b> do you have with playing music (on <b>any instrument</b>)?
<select id="musicexperience" name="musicexperience">
<option value="0">(select an option)</option>
<option value="2">less than a month of experience</option>
<option value="3">1-5 months of experience</option>
<option value="4">6-11 months of experience</option>
<option value="5">1 year of experience</option>
<option value="6">2 years of experience</option>
<option value="7">3 years of experience</option>
<option value="8">4 years of experience</option>
<option value="9">over 4 years of experience</option>
</select>

<br/><br/>

4) When was the <b>most recent</b> time you have practiced playing music (on <b>any instrument</b>)?
<select id="musicrecency" name="musicrecency">
<option value="0">(select an option)</option>
<option value="2">less than a month ago</option>
<option value="3">1-5 months ago</option>
<option value="4">6-11 months ago</option>
<option value="5">1 ago</option>
<option value="6">2 years ago</option>
<option value="7">3 years ago</option>
<option value="8">4 years ago</option>
<option value="9">over 4 years ago</option>
</select>

<br/><br/>

5) How much <b>experience</b> do you have with playing the <b>piano</b>?
<select id="pianoexperience" name="pianoexperience">
<option value="0">(select an option)</option>
<option value="1">have never played the piano</option>
<option value="2">less than a month of experience</option>
<option value="3">1-5 months of experience</option>
<option value="4">6-11 months of experience</option>
<option value="5">1 year of experience</option>
<option value="6">2 years of experience</option>
<option value="7">3 years of experience</option>
<option value="8">4 years of experience</option>
<option value="9">over 4 years of experience</option>
</select>

<br/><br/>

6) When was the <b>most recent</b> time you have practiced playing the <b>piano</b>?
<select id="pianorecency" name="pianorecency">
<option value="0">(select an option)</option>
<option value="1">have never played the piano</option>
<option value="2">less than a month ago</option>
<option value="3">1-5 months ago</option>
<option value="4">6-11 months ago</option>
<option value="5">1 ago</option>
<option value="6">2 years ago</option>
<option value="7">3 years ago</option>
<option value="8">4 years ago</option>
<option value="9">over 4 years ago</option>
</select>

<br/><br/>

7) Have you previously heard/played the pieces you played in this task? Do you know their names?<br/>

Name of Piece 1 (leave blank if you don't know it): <input id="piece1name" name="piece1name"></input><br/>
Have you ever heard this piece?
<input type="radio" value="Yes" name="piece1heard" id="piece1heardyes"><label for="piece1heardyes">Yes</label>
<input type="radio" value="No" name="piece1heard" id="piece1heardno"><label for="piece1heardno">No</label>
<br/>
Have you ever played this piece?
<input type="radio" value="Yes" name="piece1played" id="piece1playedyes"><label for="piece1playedyes">Yes</label>
<input type="radio" value="No" name="piece1played" id="piece1playedno"><label for="piece1playedno">No</label>
<br/><br/>
Name of Piece 2 (leave blank if you don't know it): <input id="piece2name" name="piece2name"></input><br/>
Have you ever heard this piece?
<input type="radio" value="Yes" name="piece2heard" id="piece2heardyes"><label for="piece2heardyes">Yes</label>
<input type="radio" value="No" name="piece2heard" id="piece2heardno"><label for="piece2heardno">No</label>
<br/>
Have you ever played this piece?
<input type="radio" value="Yes" name="piece2played" id="piece2playedyes"><label for="piece2playedyes">Yes</label>
<input type="radio" value="No" name="piece2played" id="piece2playedno"><label for="piece2playedno">No</label>
<br/>

<br/>

8) Do you have any comments about this task?
<br/>
<textarea id="misccomments" name="misccomments" style="width: 400; height: 80"></textarea>

</div>
